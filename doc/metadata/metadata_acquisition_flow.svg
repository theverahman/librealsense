<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1443" height="782"><source><![CDATA[title: RS4xx - Metadata attributes propagation and query flow
Participant User Code
Participant rs2_device
Participant rs2_frame_callback
Participant rs2_frame
Participant rs2_backend
Participant Kernel/OS Driver
User Code->User Code: Initialize librealsense
Note over User Code,rs2_device:  Acquire Device handle
User Code->rs2_device: Start Stream (user-defined callback)
Note over rs2_device,rs2_frame_callback: Store callback handle
rs2_device->rs2_backend: Start Polling frames
Note over rs2_backend,Kernel/OS Driver: Polling frame
rs2_backend->rs2_frame: unpack and store frame pixels
rs2_backend->rs2_frame: check and store metadata payload
rs2_frame-->rs2_backend: frame is ready for dispatch
rs2_backend->rs2_frame_callback: invoke user-defined callback(rs2_frame)
rs2_frame_callback->rs2_frame_callback: User code is invoked
rs2_frame_callback->rs2_frame: Check metadata attribute support
rs2_frame-->rs2_frame_callback: result (true/false)
rs2_frame_callback->rs2_frame: query metadata attribute value
rs2_frame-->rs2_frame_callback: value(/exception)]]></source><desc>RS4xx - Metadata attributes propagation and query flow</desc><defs><marker id="markerArrowBlock" markerHeight="5" markerWidth="5" orient="auto" refX="5" refY="2.5" viewBox="0 0 5 5"><path d="M 0 0 L 5 2.5 L 0 5 z"/></marker><marker id="markerArrowOpen" markerHeight="16" markerWidth="4" orient="auto" refX="9.6" refY="8" viewBox="0 0 9.6 16"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"/></marker></defs><g class="title"><rect width="485.234" height="29" x="10" y="10" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="15" y="30" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="15">RS4xx - Metadata attributes propagation and query flow</tspan></text></g><g class="actor"><rect width="99.375" height="39" x="10" y="49" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="20" y="74" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="20">User Code</tspan></text></g><g class="actor"><rect width="99.375" height="39" x="10" y="723" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="20" y="748" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="20">User Code</tspan></text></g><line x1="59.688" x2="59.688" y1="88" y2="723" fill="none" stroke="#000" style="stroke-width:2"/><g class="actor"><rect width="108.172" height="39" x="342.289" y="49" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="352.289" y="74" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="352.289">rs2_device</tspan></text></g><g class="actor"><rect width="108.172" height="39" x="342.289" y="723" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="352.289" y="748" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="352.289">rs2_device</tspan></text></g><line x1="396.375" x2="396.375" y1="88" y2="723" fill="none" stroke="#000" style="stroke-width:2"/><g class="actor"><rect width="178.547" height="39" x="482.039" y="49" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="492.039" y="74" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="492.039">rs2_frame_callback</tspan></text></g><g class="actor"><rect width="178.547" height="39" x="482.039" y="723" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="492.039" y="748" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="492.039">rs2_frame_callback</tspan></text></g><line x1="571.313" x2="571.313" y1="88" y2="723" fill="none" stroke="#000" style="stroke-width:2"/><g class="actor"><rect width="99.375" height="39" x="823.125" y="49" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="833.125" y="74" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="833.125">rs2_frame</tspan></text></g><g class="actor"><rect width="99.375" height="39" x="823.125" y="723" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="833.125" y="748" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="833.125">rs2_frame</tspan></text></g><line x1="872.813" x2="872.813" y1="88" y2="723" fill="none" stroke="#000" style="stroke-width:2"/><g class="actor"><rect width="116.766" height="39" x="1115.93" y="49" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="1125.93" y="74" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="1125.93">rs2_backend</tspan></text></g><g class="actor"><rect width="116.766" height="39" x="1115.93" y="723" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="1125.93" y="748" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="1125.93">rs2_backend</tspan></text></g><line x1="1174.313" x2="1174.313" y1="88" y2="723" fill="none" stroke="#000" style="stroke-width:2"/><g class="actor"><rect width="160.953" height="39" x="1252.695" y="49" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="1262.695" y="74" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="1262.695">Kernel/OS Driver</tspan></text></g><g class="actor"><rect width="160.953" height="39" x="1252.695" y="723" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="1262.695" y="748" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="1262.695">Kernel/OS Driver</tspan></text></g><line x1="1333.172" x2="1333.172" y1="88" y2="723" fill="none" stroke="#000" style="stroke-width:2"/><g class="signal"><text x="84.688" y="122.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="84.688">Initialize librealsense</tspan></text><line x1="59.688" x2="79.688" y1="108" y2="108" fill="none" stroke="#000" style="stroke-width:2"/><line x1="79.688" x2="79.688" y1="108" y2="132" fill="none" stroke="#000" style="stroke-width:2"/><line x1="79.688" x2="59.688" y1="132" y2="132" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="note"><rect width="356.688" height="29" x="49.688" y="147" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="55.688" y="167" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="54.688">Acquire Device handle</tspan></text></g><g class="signal"><text x="69.688" y="206.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="69.688">Start Stream (user-defined callback)</tspan></text><line x1="59.688" x2="396.375" y1="215" y2="215" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="note"><rect width="194.938" height="29" x="386.375" y="235" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="391.375" y="255" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="391.375">Store callback handle</tspan></text></g><g class="signal"><text x="697.375" y="294.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="697.375">Start Polling frames</tspan></text><line x1="396.375" x2="1174.313" y1="303" y2="303" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="note"><rect width="178.859" height="29" x="1164.313" y="323" fill="#fff" stroke="#000" style="stroke-width:2"/><text x="1169.313" y="343" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="1169.313">Polling frame</tspan></text></g><g class="signal"><text x="896.008" y="382.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="896.008">unpack and store frame pixels</tspan></text><line x1="1174.313" x2="872.813" y1="391" y2="391" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="882.813" y="421.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="882.813">check and store metadata payload</tspan></text><line x1="1174.313" x2="872.813" y1="430" y2="430" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="904.805" y="460.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="904.805">frame is ready for dispatch</tspan></text><line x1="872.813" x2="1174.313" y1="469" y2="469" fill="none" stroke="#000" style="stroke-width:2;stroke-dasharray:6,2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="701.273" y="499.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="701.273">invoke user-defined callback(rs2_frame)</tspan></text><line x1="1174.313" x2="571.313" y1="508" y2="508" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="596.313" y="542.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="596.313">User code is invoked</tspan></text><line x1="571.313" x2="591.313" y1="528" y2="528" fill="none" stroke="#000" style="stroke-width:2"/><line x1="591.313" x2="591.313" y1="528" y2="552" fill="none" stroke="#000" style="stroke-width:2"/><line x1="591.313" x2="571.313" y1="552" y2="552" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="581.313" y="577.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="581.313">Check metadata attribute support</tspan></text><line x1="571.313" x2="872.813" y1="586" y2="586" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="638.492" y="616.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="638.492">result (true/false)</tspan></text><line x1="872.813" x2="571.313" y1="625" y2="625" fill="none" stroke="#000" style="stroke-width:2;stroke-dasharray:6,2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="590.008" y="655.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="590.008">query metadata attribute value</tspan></text><line x1="571.313" x2="872.813" y1="664" y2="664" fill="none" stroke="#000" style="stroke-width:2;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="647.289" y="694.5" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="647.289">value(/exception)</tspan></text><line x1="872.813" x2="571.313" y1="703" y2="703" fill="none" stroke="#000" style="stroke-width:2;stroke-dasharray:6,2;marker-end:url(#markerArrowBlock)"/></g></svg>